<!DOCTYPE html>
<html lang="cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Text</title>
    <!-- 导入css -->
    <link rel="icon" href="/text.png">
    <link rel="stylesheet" href="/style.css"/>
  <meta name="generator" content="Hexo 5.4.2"></head>
  <body>

  <div id="page-container">
    <span class="pai">
    <a class="kong" href="/"> 主页 </a>
    <a class="kong" href="/archives"> 分类 </a>
    <a class="kong" href="/about"> 关于 </a>
</span>

    <div id="content-wrap">
        <div class="container">
          <!-- 点击文章 -->
<div>
  <h1>爬虫 selenium自动化(牢饭吃到饱)</h1>
  <wenzhang>
      <div class="contents">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%AE%9E%E9%99%85%E7%8E%AF%E5%A2%83%E9%80%89%E6%8B%A9%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%B0%B7%E6%AD%8C%E6%B5%8F%E8%A7%88%E5%99%A8-%E7%81%AB%E7%8B%90%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="toc-text">根据实际环境选择浏览器 谷歌浏览器&#x2F;火狐浏览器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C"><span class="toc-text">其他操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#driver%E5%AF%B9%E8%B1%A1%E5%AE%9A%E4%BD%8D%E6%A0%87%E7%AD%BE%E5%85%83%E7%B4%A0%E8%8E%B7%E5%8F%96%E6%A0%87%E7%AD%BE%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95"><span class="toc-text">driver对象定位标签元素获取标签对象方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E5%AF%B9%E8%B1%A1%E6%8F%90%E5%8F%96%E6%96%87%E6%9C%AC%E5%86%85%E5%AE%B9%E5%92%8C%E5%B1%9E%E6%80%A7%E5%80%BC"><span class="toc-text">标签对象提取文本内容和属性值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E9%A1%B5%E7%9A%84%E5%88%87%E6%8D%A2"><span class="toc-text">标签页的切换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%88%87%E6%8D%A2"><span class="toc-text">窗口切换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cookies%E6%93%8D%E4%BD%9C"><span class="toc-text">cookies操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ejs%E6%89%A7%E8%A1%8C"><span class="toc-text">关于js执行</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E7%95%8C%E9%9D%A2%E6%A8%A1%E5%BC%8F"><span class="toc-text">无界面模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%90%86"><span class="toc-text">代理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2user-agent-%E4%B8%8A%E7%BD%91%E8%AE%BE%E5%A4%87"><span class="toc-text">替换user-agent(上网设备)</span></a></li></ol>
      </div>
      <p><strong>每天一个入狱小技巧</strong></p>
<span id="more"></span>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p><strong>打开cmd 输入以下内容</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell">pip install selenium<br></code></pre></td></tr></table></figure>

<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul>
<li>代码调用webdriver操作浏览器</li>
<li>不同的浏览器使用各自不同的driver</li>
</ul>
<h2 id="根据实际环境选择浏览器-谷歌浏览器-火狐浏览器"><a href="#根据实际环境选择浏览器-谷歌浏览器-火狐浏览器" class="headerlink" title="根据实际环境选择浏览器 谷歌浏览器/火狐浏览器"></a>根据实际环境选择浏览器 谷歌浏览器/火狐浏览器</h2><ul>
<li>开发使用有头浏览器</li>
<li>部署使用无头浏览器</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># 采用有头浏览器</span><br>browser = webdriver.Chrome()<br><br><span class="hljs-comment"># 要爬取的网页</span><br>browser.get(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)<br><br><span class="hljs-comment"># 在百度中搜索史迪奇</span><br>browser.find_element_by_id(<span class="hljs-string">&#x27;kw&#x27;</span>).send_keys(<span class="hljs-string">&#x27;史迪奇&#x27;</span>)<br><br><span class="hljs-comment">#模拟点击</span><br>browser.find_element_by_id(<span class="hljs-string">&#x27;su&#x27;</span>).click<br><br><span class="hljs-comment"># 延时3秒</span><br>time.sleep(<span class="hljs-number">3</span>)<br><br><span class="hljs-comment"># 一定要退出</span><br>browser.quit()<br></code></pre></td></tr></table></figure>

<h1 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 当前标签页浏览器渲染之后的网页源代码</span><br>browser.page_source<br><br><span class="hljs-comment"># 当前标签页的url</span><br>browser.current_url<br><br><span class="hljs-comment"># 关闭当前标签页面, 如果只有一个标签页面则关闭整个浏览器</span><br>browser.close()<br><br><span class="hljs-comment"># 关闭浏览器</span><br>browser.quit()<br><br><span class="hljs-comment"># 页面前进</span><br>browser.forward()<br><br><span class="hljs-comment"># 页面后退</span><br>browser.back()<br><br><span class="hljs-comment"># 页面截图</span><br>browser.screen_shot(img_name)<br></code></pre></td></tr></table></figure>

<h1 id="driver对象定位标签元素获取标签对象方法"><a href="#driver对象定位标签元素获取标签对象方法" class="headerlink" title="driver对象定位标签元素获取标签对象方法"></a>driver对象定位标签元素获取标签对象方法</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 返回一个元素</span><br>find_element_by_id<br><br><span class="hljs-comment"># 根据类名获取元素列表</span><br>find_element(s)_by_class_name<br><br><span class="hljs-comment"># 根据标签的name属性值返回包括标签对象元素的列表</span><br>find_element(s)_by_name<br><br><span class="hljs-comment"># 返回一个包含元素的列表</span><br>find_element(s)_by_xpath<br><br><span class="hljs-comment"># 根据连接文本获取元素列表</span><br>find_element(s)_by_link_text<br><br><span class="hljs-comment"># 根据标签名获取元素列表</span><br>find_element(s)_by_partial_link_text<br><br><span class="hljs-comment"># 根据css选择器来获取元素列表</span><br>find_element(s)_by_css<br></code></pre></td></tr></table></figure>

<p><strong>特别注意:</strong></p>
<ul>
<li>find_element和find_elements的区别: <ul>
<li>多了给s就返回列表, 没有s就返回匹配到的第一个标签对象</li>
<li>find_element匹配不到就抛出异常, find_elements匹配不到就返回空列表</li>
</ul>
</li>
</ul>
<ul>
<li>by_link_text和by_partial_link_text的区别: <ul>
<li>全部文本和包含某个文本</li>
</ul>
</li>
</ul>
<ul>
<li>find_element_by_xxx<ul>
<li>定位到则是一个对象</li>
<li>定位不到则是报错</li>
</ul>
</li>
</ul>
<ul>
<li>find_elements_by_xxx<ul>
<li>定位到则是一个含有元素的列表</li>
<li>定位不到则是空列表</li>
</ul>
</li>
</ul>
<h1 id="标签对象提取文本内容和属性值"><a href="#标签对象提取文本内容和属性值" class="headerlink" title="标签对象提取文本内容和属性值"></a>标签对象提取文本内容和属性值</h1><ul>
<li>获取文本 element.text<ul>
<li>通过定位获取的标签对象的 text 属性, 获取文本内容</li>
</ul>
</li>
</ul>
<ul>
<li>获取属性值 element.get_attribute(“属性名”)<ul>
<li>通过定位获取的标签对get_attribute 函数, 传入属性名, 来获取获取属性的值</li>
</ul>
</li>
</ul>
<p><strong>例子</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;https://sz.58.com/ershoufang/?PGTID=0d200001-0000-4f6f-f947-87e3a87719a1&amp;ClickID=1&quot;</span><br><br>browser = webdriver.Chrome()<br><br>browser.get(url)<br><br>el_list = browser.find_elements_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;__layout&quot;]/div/section/section[3]/section[1]/section[2]/div/a/div[2]/div[1]/div[1]/h3&#x27;</span>)<br><br><span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> el_list:<br>    <span class="hljs-built_in">print</span>(el.text,el.get_attribute(<span class="hljs-string">&#x27;href&#x27;</span>))<br></code></pre></td></tr></table></figure>

<h1 id="标签页的切换"><a href="#标签页的切换" class="headerlink" title="标签页的切换"></a>标签页的切换</h1><ul>
<li><p>获取所有标签页的窗口句柄</p>
</li>
<li><p>利用窗口句柄字切换句柄指向的标签页</p>
<ul>
<li>这里的窗口句柄是指:<ul>
<li>指向标签页对象的标识</li>
</ul>
</li>
</ul>
</li>
</ul>
<br>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 获取当前所有的标签页的句柄构成的列表</span><br>current_windows = browser.window_handles<br><br><span class="hljs-comment"># 根据标签页句柄列表索引下标进行切换</span><br>browser.switch_to.window(current_windous[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure>

<h1 id="窗口切换"><a href="#窗口切换" class="headerlink" title="窗口切换"></a>窗口切换</h1><p><strong>ifame是html中常用的一种技术, 即一个页面嵌套</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 操作frame外边的元素需要切换出去</span><br>Windows = browser.window_handles<br>browser.switch_to.window(windows[<span class="hljs-number">0</span>])<br>content = browser.find_element_by_class_name().text<br><span class="hljs-built_in">print</span>(content)<br>browser.quit()<br></code></pre></td></tr></table></figure>

<h1 id="cookies操作"><a href="#cookies操作" class="headerlink" title="cookies操作"></a>cookies操作</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;http://www.baidu.com/&quot;</span><br><br>browser = webdriver.Chrome()<br>browser.get(url)<br><br><span class="hljs-comment"># cookies = &#123;&#125;</span><br><span class="hljs-comment"># for data in browser.get_cookies():</span><br><span class="hljs-comment">#     cookies[data[&#x27;name&#x27;]] = data[&#x27;value&#x27;]</span><br><br><span class="hljs-comment"># 字典推导式</span><br>cookies  = &#123;data[<span class="hljs-string">&#x27;name&#x27;</span>] : data[<span class="hljs-string">&#x27;value&#x27;</span>]<span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> browser.get_cookies()&#125;<br><br><span class="hljs-built_in">print</span>(cookies)<br></code></pre></td></tr></table></figure>

<h1 id="关于js执行"><a href="#关于js执行" class="headerlink" title="关于js执行"></a>关于js执行</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br>url = <span class="hljs-string">&quot;http://jn.lianjia.com/&quot;</span><br><br>browser = webdriver.Chrome()<br><br>browser.get(url)<br><br><span class="hljs-comment"># 滚动条拖动 x和y</span><br>js = <span class="hljs-string">&#x27;scrollTo(0,900)&#x27;</span><br><br><span class="hljs-comment"># 执行js</span><br>browser.execute_script(js)<br></code></pre></td></tr></table></figure>

<h1 id="无界面模式"><a href="#无界面模式" class="headerlink" title="无界面模式"></a>无界面模式</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 配置对象添加开启无界面模式的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--headless&quot;</span>)<br><br><span class="hljs-comment"># 配置对象添加禁用gpu的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--disable-gpu&quot;</span>)<br><br><span class="hljs-comment"># 实例化带有配置对象的browser对象</span><br>browser = webdriver.Chrome(chrome_options=options)<br></code></pre></td></tr></table></figure>

<h1 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 配置对象添加使用代理ip的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--proxy-server=http://202.20.16.82:9527&quot;</span>)<br><br><span class="hljs-comment"># 配置对象添加禁用gpu的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--disable-gpu&quot;</span>)<br><br><span class="hljs-comment"># 实例化带有配置对象的browser对象</span><br>browser = webdriver.Chrome(<span class="hljs-string">&#x27;./chromedriver&#x27;</span>,chome_options=options)<br></code></pre></td></tr></table></figure>

<h1 id="替换user-agent-上网设备"><a href="#替换user-agent-上网设备" class="headerlink" title="替换user-agent(上网设备)"></a>替换user-agent(上网设备)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 实例化配置对象</span><br>options = webdriver.ChromeOptions()<br><br><span class="hljs-comment"># 配置对象添加使用代理ip的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--user-agent=Mozilla/5.0 HAHA&quot;</span>)<br><br><span class="hljs-comment"># 配置对象添加禁用gpu的命令</span><br>options.add_argument(<span class="hljs-string">&quot;--disable-gpu&quot;</span>)<br><br><span class="hljs-comment"># 实例化带有配置对象的browser对象</span><br>browser = webdriver.Chrome(<span class="hljs-string">&#x27;./chromedriver&#x27;</span>,chome_options=options)<br></code></pre></td></tr></table></figure>

<br>

<br>

<br>
      <div id="lv-container" data-id="city" data-uid="MTAyMC80NTk3NS8yMjQ4Ng==">
  <!-- 评论系统 -->
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
  
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
  
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>


  </wenzhang>






        </div>
    </div>
    
<footer id="footer" >
    <span class="konga">
        <a class="jiao"  href="."><</a>
            <input type="text" id="text_input"  placeholder="搜索" >
            
        <a class="jiao"  href=".">></a>
    </span>
    <div id="text_output"></div>
    </div>

</footer>

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<bokebangquan>
<!-- 博客版权 -->
<p><strong>
  作者: 我叫史迪奇
  <br>
  本文来自于: 
   <a href="https://sdq3.link/reptile-selenium.html">https://sdq3.link/reptile-selenium.html</a>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</strong></p>

</bokebangqua>


  </div>
  
<script src="/jquery.min.js"></script>

  
<script src="/main.js"></script>

  </body>
</html>
